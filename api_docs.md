# Документация API для CHOIZZE

## Аутентификация

---

### Регистрация пользователя

* **Метод:** `POST`
* **URL:** `/register`
* **Описание:** Создает нового пользователя в системе.
* **Headers:** Нет
* **Body (JSON):**
    ```json
    {
      "username": "имя_пользователя",
      "email": "email_пользователя",
      "password": "пароль_пользователя"
    }
    ```
* **Пример ответа (201 Created):**
    ```json
    {
      "message": "Пользователь успешно зарегистрирован",
      "user": {
        "id": 1,
        "username": "имя_пользователя",
        "email": "email_пользователя"
      }
    }
    ```
* **Пример ответа (400 Bad Request - неполные данные):**
    ```json
    {
      "error": "Пожалуйста, заполните все поля."
    }
    ```
* **Пример ответа (409 Conflict - пользователь уже существует):**
    ```json
    {
      "error": "Пользователь с таким именем или email уже существует."
    }
    ```

---

### Авторизация пользователя

* **Метод:** `POST`
* **URL:** `/login`
* **Описание:** Авторизует пользователя и возвращает JWT-токен.
* **Headers:** Нет
* **Body (JSON):**
    ```json
    {
      "email": "email_пользователя",
      "password": "пароля_пользователя"
    }
    ```
* **Пример ответа (200 OK):**
    ```json
    {
      "message": "Авторизация прошла успешно",
      "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
      "user": {
        "id": 1,
        "username": "имя_пользователя",
        "email": "email_пользователя"
      }
    }
    ```
* **Пример ответа (401 Unauthorized - неверные данные):**
    ```json
    {
      "error": "Неверный email или пароль."
    }
    ```

## Управление пользователем

---

### Получение данных пользователя

* **Метод:** `GET`
* **URL:** `/user/:id`
* **Описание:** Получает публичные данные о пользователе, включая информацию из профиля.
* **Headers:** Нет
* **Параметры URL:** `id` - ID пользователя, чьи данные нужно получить.
* **Пример ответа (200 OK):**
    ```json
    {
      "id": 1,
      "username": "first_user",
      "email": "first@example.com",
      "avatar_url": "[https://example.com/avatar.jpg](https://example.com/avatar.jpg)",
      "birth_date": "1990-01-01T00:00:00.000Z",
      "gender": "male",
      "city": "Алматы"
    }
    ```
* **Пример ответа (404 Not Found):**
    ```json
    {
      "message": "Пользователь не найден"
    }
    ```

---

### Обновление данных пользователя

* **Метод:** `PUT`
* **URL:** `/user/:id`
* **Описание:** Обновляет данные авторизованного пользователя.
* **Headers:**
    - `Authorization`: `Bearer <JWT_токен>`
* **Параметры URL:** `id` - ID пользователя, чьи данные нужно обновить.
* **Body (JSON):**
    ```json
    {
      "username": "новое_имя",
      "email": "новый_email@example.com"
    }
    ```
* **Пример ответа (200 OK):**
    ```json
    {
      "message": "Данные пользователя успешно обновлены",
      "user": {
        "id": 1,
        "username": "новое_имя",
        "email": "новый_email@example.com"
      }
    }
    ```
* **Пример ответа (403 Forbidden):**
    ```json
    {
      "error": "Доступ запрещен."
    }
    ```

---

### Удаление пользователя

* **Метод:** `DELETE`
* **URL:** `/user/:id`
* **Описание:** Удаляет авторизованного пользователя.
* **Headers:**
    - `Authorization`: `Bearer <JWT_токен>`
* **Параметры URL:** `id` - ID пользователя, которого нужно удалить.
* **Пример ответа (200 OK):**
    ```json
    {
      "message": "Пользователь успешно удален"
    }
    ```
* **Пример ответа (403 Forbidden):**
    ```json
    {
      "error": "Доступ запрещен."
    }
    ```

---

### Получение статистики пользователя

* **Метод:** `GET`
* **URL:** `/stats`
* **Описание:** Получает текущую статистику авторизованного пользователя (жизни, фишки для бана).
* **Headers:**
    - `Authorization`: `Bearer <JWT_токен>`
* **Пример ответа (200 OK):**
    ```json
    {
      "lives": 3,
      "ban_tokens": 1,
      "trial_time_spent": 0
    }
    ```
* **Пример ответа (404 Not Found):**
    ```json
    {
      "message": "Статистика пользователя не найдена"
    }
    ```

---

### Создание/обновление профиля

* **Метод:** `POST`
* **URL:** `/profiles`
* **Описание:** Создает новый или обновляет существующий профиль авторизованного пользователя.
* **Headers:**
    - `Authorization`: `Bearer <JWT_токен>`
* **Body (JSON):**
    ```json
    {
      "avatarUrl": "[https://example.com/new_avatar.jpg](https://example.com/new_avatar.jpg)",
      "birthDate": "1995-05-15",
      "gender": "female",
      "city": "Астана"
    }
    ```
* **Пример ответа (201 Created):**
    ```json
    {
      "message": "Профиль успешно создан.",
      "profile": { ... }
    }
    ```
* **Пример ответа (200 OK):**
    ```json
    {
      "message": "Профиль успешно обновлен.",
      "profile": { ... }
    }
    ```

---

### Отправка жалобы

* **Метод:** `POST`
* **URL:** `/reports`
* **Описание:** Отправляет жалобу на другого пользователя. Уменьшает количество `ban_tokens` на 1.
* **Headers:**
    - `Authorization`: `Bearer <JWT_токен>`
* **Body (JSON):**
    ```json
    {
      "reportedId": 3,
      "reportReason": "Неуважительное отношение"
    }
    ```
* **Пример ответа (201 Created):**
    ```json
    {
      "message": "Жалоба успешно отправлена."
    }
    ```
* **Пример ответа (403 Forbidden - нет токенов):**
    ```json
    {
      "error": "Недостаточно \"фишек для бана\" для отправки жалобы."
    }
    ```

## Коммуникация

---

### Отправка запроса на дружбу

* **Метод:** `POST`
* **URL:** `/friends/request`
* **Описание:** Отправляет запрос на дружбу от авторизованного пользователя другому пользователю.
* **Headers:**
    - `Authorization`: `Bearer <JWT_токен>`
* **Body (JSON):**
    ```json
    {
      "receiverId": 2
    }
    ```
* **Пример ответа (201 Created):**
    ```json
    {
      "message": "Запрос на дружбу отправлен."
    }
    ```
* **Пример ответа (400 Bad Request):**
    ```json
    {
      "error": "Вы не можете отправить запрос самому себе."
    }
    ```

---

### Принятие запроса на дружбу

* **Метод:** `PUT`
* **URL:** `/friends/accept`
* **Описание:** Принимает запрос на дружбу от другого пользователя.
* **Headers:**
    - `Authorization`: `Bearer <JWT_токен>`
* **Body (JSON):**
    ```json
    {
      "senderId": 1
    }
    ```
* **Пример ответа (200 OK):**
    ```json
    {
      "message": "Запрос на дружбу принят."
    }
    ```
* **Пример ответа (404 Not Found):**
    ```json
    {
      "error": "Запрос на дружбу не найден."
    }
    ```

---

### Получение списка друзей

* **Метод:** `GET`
* **URL:** `/friends`
* **Описание:** Возвращает список всех друзей авторизованного пользователя.
* **Headers:**
    - `Authorization`: `Bearer <JWT_токен>`
* **Пример ответа (200 OK):**
    ```json
    [
      {
        "id": 2,
        "username": "user_two",
        "email": "user2@example.com"
      },
      {
        "id": 3,
        "username": "user_three",
        "email": "user3@example.com"
      }
    ]
    ```

---

### Отправка личного сообщения

* **Метод:** `POST`
* **URL:** `/messages`
* **Описание:** Отправляет личное сообщение другу.
* **Headers:**
    - `Authorization`: `Bearer <JWT_токен>`
* **Body (JSON):**
    ```json
    {
      "receiverId": 2,
      "messageText": "Привет! Как дела?"
    }
    ```
* **Пример ответа (201 Created):**
    ```json
    {
      "message": "Сообщение отправлено."
    }
    ```
* **Пример ответа (403 Forbidden - не друзья):**
    ```json
    {
      "error": "Вы не можете отправлять сообщения этому пользователю."
    }
    ```

---

### Получение истории сообщений

* **Метод:** `GET`
* **URL:** `/messages/:friendId`
* **Описание:** Получает историю сообщений между авторизованным пользователем и другом.
* **Headers:**
    - `Authorization`: `Bearer <JWT_токен>`
* **Параметры URL:** `friendId` - ID друга.
* **Пример ответа (200 OK):**
    ```json
    [
      {
        "id": 1,
        "sender_id": 1,
        "receiver_id": 2,
        "message_text": "Привет! Как дела?",
        "created_at": "2025-08-01T10:00:00.000Z"
      },
      {
        "id": 2,
        "sender_id": 2,
        "receiver_id": 1,
        "message_text": "Привет! Отлично, а у тебя?",
        "created_at": "2025-08-01T10:01:00.000Z"
      }
    ]
    ```
---

### Добавление поста в ленту новостей

* **Метод:** `POST`
* **URL:** `/news`
* **Описание:** Добавляет новый пост в ленту новостей.
* **Headers:**
    - `Authorization`: `Bearer <JWT_токен>`
* **Body (JSON):**
    ```json
    {
      "contentType": "text",
      "contentUrl": null,
      "contentText": "Это мой первый пост!"
    }
    ```
* **Пример ответа (201 Created):**
    ```json
    {
      "message": "Пост успешно добавлен в ленту.",
      "post": {
        "id": 1,
        "author_id": 1,
        "content_type": "text",
        "content_url": null,
        "content_text": "Это мой первый пост!",
        "created_at": "2025-08-02T05:07:50.791Z"
      }
    }
    ```

---

### Получение ленты новостей

* **Метод:** `GET`
* **URL:** `/news`
* **Описание:** Получает 50 последних постов из ленты новостей.
* **Headers:**
    - `Authorization`: `Bearer <JWT_токен>`
* **Пример ответа (200 OK):**
    ```json
    [
      {
        "id": 1,
        "author_id": 2,
        "username": "user_two",
        "content_type": "text",
        "content_url": null,
        "content_text": "Привет, всем! Это мой первый пост!",
        "created_at": "2025-08-02T05:07:50.791Z"
      }
    ]
    ```

---

### Поиск собеседника (Matchmaking)

* **Метод:** `GET`
* **URL:** `/match`
* **Описание:** Находит случайного пользователя для общения, который не является другом.
* **Headers:**
    - `Authorization`: `Bearer <JWT_токен>`
* **Пример ответа (200 OK):**
    ```json
    {
      "id": 4,
      "username": "new_user_4",
      "email": "user4@example.com",
      "avatar_url": null,
      "birth_date": null,
      "gender": null,
      "city": null
    }
    ```
* **Пример ответа (404 Not Found):**
    ```json
    {
      "message": "Собеседник не найден. Попробуйте позже."
    }
    ```

## Монетизация

---

### Покупка подписки

* **Метод:** `POST`
* **URL:** `/subscribe`
* **Описание:** Имитирует покупку подписки.
* **Headers:**
    - `Authorization`: `Bearer <JWT_токен>`
* **Body (JSON):**
    - Пустой объект `{}`
* **Пример ответа (201 Created):**
    ```json
    {
      "message": "Подписка успешно оформлена.",
      "subscription": { ... }
    }
    ```

---

### Получение информации о подписке

* **Метод:** `GET`
* **URL:** `/subscriptions`
* **Описание:** Возвращает информацию об активной подписке авторизованного пользователя.
* **Headers:**
    - `Authorization`: `Bearer <JWT_токен>`
* **Пример ответа (200 OK):**
    ```json
    {
      "id": 1,
      "user_id": 2,
      "transaction_id": 1,
      "status": "active",
      "start_date": "2025-08-02T06:07:06.095Z",
      "end_date": "2025-09-01T06:07:06.088Z",
      "created_at": "2025-08-02T06:07:06.095Z"
    }
    ```
* **Пример ответа (404 Not Found):**
    ```json
    {
      "message": "Активная подписка не найдена."
    }
    ```